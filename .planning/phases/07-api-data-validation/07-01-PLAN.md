# Plan 07-01: Audit Incident-Centric Endpoints

## Objective
Verify incident list/detail/dossier/dashboard return complete related data

## Scope
Audit only - document findings for Phase 10 fixes

---

## Tasks

### Task 1: Verify Incident List JOIN
**Files**: `apps/web/src/app/api/incidents/route.js`

- [ ] Check employee fields returned (employee_name, employee_number)
- [ ] Check client fields returned (client_name, client_location)
- [ ] Verify client isolation works with JOINs
- [ ] Document the JOIN pattern used

### Task 2: Verify Incident Detail JOIN
**Files**: `apps/web/src/app/api/incidents/[id]/route.js`

- [ ] Document all employee fields returned (full_name, employee_number, job_position, phone)
- [ ] Document all client fields returned (name, location, contact_name, contact_phone, logo_url)
- [ ] Check field aliasing matches mobile app expectations
- [ ] Verify LEFT JOIN handles missing relations

### Task 3: Verify Dossier Endpoint
**Files**: `apps/web/src/app/api/incidents/[id]/dossier/route.js`

- [ ] Check evidence collection included
- [ ] Check interviews collection included
- [ ] Check corrective_actions collection included
- [ ] Check root_cause included
- [ ] Verify witness interviews attached to parent interviews
- [ ] Document multi-query pattern

### Task 4: Verify Dashboard Stats
**Files**: `apps/web/src/app/api/dashboard/stats/route.js`

- [ ] Check recentActivity has employee_name
- [ ] Check recentActivity has client_name
- [ ] Verify trend data structure (array of {day, count})
- [ ] Verify typeBreakdown structure

---

## Files to Read

```
apps/web/src/app/api/incidents/route.js
apps/web/src/app/api/incidents/[id]/route.js
apps/web/src/app/api/incidents/[id]/dossier/route.js
apps/web/src/app/api/dashboard/stats/route.js
```

## Files to Modify
None (audit only - creates SUMMARY.md)

---

## Verification
- [ ] Incident list JOIN verified with field mapping
- [ ] Incident detail JOIN verified with all fields
- [ ] Dossier multi-query pattern documented
- [ ] Dashboard stats verified
- [ ] SUMMARY.md created with findings
